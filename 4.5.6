# Install packages if needed
# install.packages("readxl")
# install.packages("randomForest")

library(readxl)
library(randomForest)

# Load dataset
df <- read_excel("c:/Files/Excel/Prescriptive_PythonR/AirbnbListings_v4.xlsx")

# Select features and target
features <- c("minimum_nights", "number_of_reviews", "availability_365")
target <- "price"

X <- df[features]
y <- df[[target]]

# Train Random Forest model
set.seed(42)
rf_model <- randomForest(x = X, y = y, ntree = 500)

# -------------------------------------------------------
# GRID SEARCH FOR OPTIMAL FEATURE VALUES
# -------------------------------------------------------

# Create search ranges (50 points each)
min_range <- seq(min(df$minimum_nights), max(df$minimum_nights), length.out = 50)
reviews_range <- seq(min(df$number_of_reviews), max(df$number_of_reviews), length.out = 50)
avail_range <- seq(min(df$availability_365), max(df$availability_365), length.out = 50)

best_price <- -Inf
best_combo <- c(NA, NA, NA)

# Triple nested loop for grid search
for (mn in min_range) {
  for (rv in reviews_range) {
    for (av in avail_range) {
      
      row <- data.frame(
        minimum_nights = mn,
        number_of_reviews = rv,
        availability_365 = av
      )
      
      pred <- predict(rf_model, row)
      
      if (pred > best_price) {
        best_price <- pred
        best_combo <- c(mn, rv, av)
      }
    }
  }
}

# -------------------------------------------------------
# DISPLAY RESULTS
# -------------------------------------------------------

cat("Optimal Feature Values:\n")
cat("  minimum_nights     =", round(best_combo[1], 2), "\n")
cat("  number_of_reviews  =", round(best_combo[2], 2), "\n")
cat("  availability_365   =", round(best_combo[3], 2), "\n\n")

cat("Optimal Predicted Price = $", round(best_price, 2), "\n")
